# ~/.config/aerospace/aerospace.toml

# --- SYSTEM CONFIG ---
start-at-login = true
enable-normalization-flatten-containers = true
enable-normalization-opposite-orientation-for-nested-containers = true
accordion-padding = 0
default-root-container-layout = 'tiles'
default-root-container-orientation = 'auto'
on-focused-monitor-changed = ['move-mouse monitor-lazy-center']
automatically-unhide-macos-hidden-apps = true

# --- HOOKS (EDR / Deadlock Safe) ---
# 1. On Startup: Reload Sketchybar (Backgrounded & Detached)
after-startup-command = [
    'exec-and-forget nohup /bin/bash -c "/opt/homebrew/bin/sketchybar --reload" > /dev/null 2>&1 &'
]

# 2. On Workspace Change: Update Sketchybar (Backgrounded & Detached)
exec-on-workspace-change = [
    '/bin/bash',
    '-c',
    'nohup /opt/homebrew/bin/sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE PREV_WORKSPACE=$AEROSPACE_PREV_WORKSPACE > /dev/null 2>&1 &'
]

# --- GAPS ---
[gaps]
inner.horizontal = 8
inner.vertical =   8
outer.left =       5
outer.right =      5
outer.bottom =     5
# 10px for Laptop (Notch), 40px for Monitor (SketchyBar)
outer.top = [ { monitor."^built-in.*" = 10 }, 40 ]

# --- KEY MAPPING ---
[key-mapping]
preset = 'qwerty'

# --- MAIN BINDINGS ---
[mode.main.binding]

# 1. System & Layout
alt-space = 'layout floating tiling'      # The "Panic Button" (Toggle Float)
alt-f = 'fullscreen'                      # AeroSpace Fullscreen (Keep bar)
alt-shift-q = [                           # Close window & refresh bar
    'close',
    'exec-and-forget nohup /bin/bash -c "/opt/homebrew/bin/sketchybar --trigger aerospace_workspace_change" > /dev/null 2>&1 &'
]
# Reload AeroSpace (triggers SketchyBar reload automatically via startup hook)
alt-shift-r = 'reload-config'

# 2. App Launchers
alt-enter = 'exec-and-forget open -a /Applications/Ghostty.app'
alt-i = 'exec-and-forget open -a /Applications/Ghostty.app'

# Browsers
alt-b = 'exec-and-forget open -a /Applications/Google\ Chrome.app'
alt-s = 'exec-and-forget open -a /Applications/Safari.app'

# Dev / Work
alt-c = 'exec-and-forget open -a /Applications/Visual\ Studio\ Code.app'
alt-o = 'exec-and-forget open -a /Applications/Microsoft\ Outlook.app/'
alt-t = 'exec-and-forget open -b com.microsoft.teams2'
alt-d = 'exec-and-forget open -a /Applications/Discord.app'

# Utilities
alt-w = 'exec-and-forget open -a /System/Library/CoreServices/Finder.app' # Files (Where?)
alt-a = 'exec-and-forget open -a /System/Applications/Utilities/Activity\ Monitor.app' # Admin
alt-n = 'exec-and-forget open -a /System/Applications/Spotify.app' # Noise/Music
alt-z = 'exec-and-forget open -a /System/Applications/System\ Settings.app' # Settings

# 3. Navigation (Vim)
alt-h = 'focus left'
alt-j = 'focus down'
alt-k = 'focus up'
alt-l = 'focus right'

# 4. Movement (Vim)
alt-shift-h = 'move left'
alt-shift-j = 'move down'
alt-shift-k = 'move up'
alt-shift-l = 'move right'

# 5. Workspaces
alt-1 = 'workspace 1'
alt-2 = 'workspace 2'
alt-3 = 'workspace 3'
alt-4 = 'workspace 4'
alt-5 = 'workspace 5'
alt-6 = 'workspace 6'
alt-7 = 'workspace 7'

alt-shift-1 = 'move-node-to-workspace 1'
alt-shift-2 = 'move-node-to-workspace 2'
alt-shift-3 = 'move-node-to-workspace 3'
alt-shift-4 = 'move-node-to-workspace 4'
alt-shift-5 = 'move-node-to-workspace 5'
alt-shift-6 = 'move-node-to-workspace 6'
alt-shift-7 = 'move-node-to-workspace 7'

alt-tab = 'workspace-back-and-forth'
alt-shift-tab = 'move-workspace-to-monitor --wrap-around next'

# 6. Modes
alt-shift-semicolon = 'mode service'
alt-r = 'mode resize'

# --- RESIZE MODE ---
[mode.resize.binding]
h = 'resize width -50'
j = 'resize height +50'
k = 'resize height -50'
l = 'resize width +50'
enter = 'mode main'
esc = 'mode main'

# --- SERVICE MODE ---
[mode.service.binding]
esc = ['reload-config', 'mode main']
r = ['flatten-workspace-tree', 'mode main']
f = ['layout floating tiling', 'mode main']
backspace = ['close-all-windows-but-current', 'mode main']
alt-shift-h = ['join-with left', 'mode main']
alt-shift-j = ['join-with down', 'mode main']
alt-shift-k = ['join-with up', 'mode main']
alt-shift-l = ['join-with right', 'mode main']

# --- WINDOW RULES (Workspace Assignment) ---

# WS 1: Browsers
[[on-window-detected]]
if.app-id = 'com.google.Chrome'
run = ['move-node-to-workspace 1']

[[on-window-detected]]
if.app-id = 'com.apple.Safari'
run = ['move-node-to-workspace 1']

# WS 2: Terminal
[[on-window-detected]]
if.app-id = 'com.mitchellh.ghostty'
run = ['move-node-to-workspace 2']

# WS 3: Code
[[on-window-detected]]
if.app-id = 'com.microsoft.VSCode'
run = ['move-node-to-workspace 3']

# WS 4: Media / Background
[[on-window-detected]]
if.app-id = 'com.apple.Music'
run = ['move-node-to-workspace 4']

# WS 5: Comms
[[on-window-detected]]
if.app-id = 'com.tinyspeck.slackmacgap'
run = ['move-node-to-workspace 5']

[[on-window-detected]]
if.app-id = 'com.hnc.Discord'
run = ['move-node-to-workspace 5']

# WS 6: Office / Secondary Monitor
[[on-window-detected]]
if.app-id = 'com.microsoft.Outlook'
run = ['move-node-to-workspace 6']

[[on-window-detected]]
if.app-id = 'com.microsoft.teams2'
run = ['move-node-to-workspace 6']


# --- FLOATING RULES (Quality of Life) ---

# System Settings / Preferences
[[on-window-detected]]
if.app-id = 'com.apple.systempreferences'
run = ['layout floating']

# Finder
[[on-window-detected]]
if.app-id = 'com.apple.finder'
run = ['layout floating']

# 1Password / Bitwarden
[[on-window-detected]]
if.app-id = 'com.1password.1password'
run = ['layout floating']

# Activity Monitor
[[on-window-detected]]
if.app-id = 'com.apple.ActivityMonitor'
run = ['layout floating']

# Calculator
[[on-window-detected]]
if.app-id = 'com.apple.calculator'
run = ['layout floating']

# Teams Calls (The separate popup window)
[[on-window-detected]]
if.app-id = 'com.microsoft.teams2'
if.window-title-regex-substring = 'Call|Meeting|Notification'
run = ['layout floating']

# --- MONITOR ASSIGNMENT ---
[workspace-to-monitor-force-assignment]
1 = 'main'
2 = 'main'
3 = 'main'
4 = 'main'
5 = 'main'
6 = 'secondary'
7 = 'secondary'
